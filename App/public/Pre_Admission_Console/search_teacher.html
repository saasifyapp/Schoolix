<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/css/Pre_Admission_Console_Css/search_teacher.css">
    <link rel="stylesheet" href="/css/Pre_Admission_Console_Css/All.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Open+Sans&display=swap">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <title>Registered Teacher Details</title>
</head>

<body>

    <div id="toast-container" class="toast-container">
        <div id="toast" class="toast"></div>
    </div>

    <div class="container-fluid">
        <div class="row flex-nowrap ">
            <div class="col-md-3 col-xl-2 px-sm-2 px-0 menu overflow-x-hidden fixed-top" style="height: 100vh;">
                <div class="d-flex flex-column align-items-center align-items-sm-start px-1 pt-1 text-black"
                    style="height: 100%;">
                    <a href="/pre_adm_dashboard"
                        class="d-flex align-items-center pb-1 py-0 mb-md-1 me-md-auto text-black text-decoration-none">
                        <span class="fs-4 d-none d-sm-inline  rounded-pill fw-500 text-decoration-none text-black p-2">
                            <i class="fs-6"> <i class="bi"><img class="icon" src="/images/preadmin.gif" alt=""></i>
                            </i>PreAdmission</span>
                    </a>
                    <ul class="nav nav-pills flex-column mb-sm-auto mb-0 align-items-center align-items-sm-start"
                        id="menu">
                        <li class="nav-item nav-link1">
                            <a onclick="showCustomAlert()" class="nav-link align-middle px-0">
                                <i class="bi fs-6 text-black"><img class="icon" src="/images/calculator.gif"></i>
                                <span class="ms-1 d-none d-sm-inline  text-black">Age Calculator</span>
                            </a>
                        </li>

                        <li class="nav-item nav-link1 ">
                            <a href="register-student" class="nav-link px-0 align-middle nav-link1 ">
                                <i class="fs-4  text-black"><img class="icon" src="/images/student.gif"></i> <span
                                    class="ms-1 d-none d-sm-inline  text-black">Register Student</span> </a>
                        </li>
                        <li class="nav-item nav-link1">
                            <a href="register-teacher" class="nav-link px-0 align-middle nav-link1">
                                <i class=" fs-4 text-black"><img class="icon" src="/images/professor.gif"></i><span
                                    class="ms-1 d-none d-sm-inline  text-black">Register Teacher</span> </a>
                        </li>
                        <li class="nav-item nav-link1">
                            <a href="search-student" class="nav-link px-0 align-middle nav-link1">
                                <i class=" fs-4 text-black "><img class="icon" src="/images/searchstudent.gif"></i>
                                <span class="ms-1 d-none d-sm-inline  text-black">Search Student</span> </a>
                        </li>
                        <li class="nav-item nav-link1 active">
                            <a href="search-teacher" class="nav-link px-0 align-middle nav-link1">
                                <i class=" fs-4 text-black"><img class="icon" src="/images/searchteacher.gif"></i> <span
                                    class="ms-1 d-none d-sm-inline  text-black">Search Teacher</span> </a>
                        </li>
                        <li class="nav-item nav-link1">
                            <a href="admitted_student" class="nav-link px-0 align-middle nav-link1">
                                <i class=" fs-4 text-black"><img class="icon" src="/images/admitstudent.gif"></i> <span
                                    class="ms-1 d-none d-sm-inline  text-black">Admitted Students</span> </a>
                        </li>
                        <li class="nav-item nav-link1 ">
                            <a href="admitted_teacher" class="nav-link px-0 align-middle nav-link1">
                                <i class="fs-4 bi text-black"><img class="icon" src="/images/admitteacher.gif"></i>
                                <span class="ms-1 d-none d-sm-inline  text-black">Admitted Teachers</span> </a>
                        </li>

                    </ul>
                    <hr>

                    <div class="pb-1 d-flex justify-content-between align-items-center w-100 mb-4">
                        <a onclick="logout()" class="d-flex flex-column align-items-center text-black nav-link1">
                            <i class=" fs-1 bi nav-item"><img class="" style="transform: rotate(180deg) ;background-color: transparent; 
                            width: 30px; height: 30px;margin-top: 3px; " src="/images/logout.png"></i>
                            <span class="ms-1 d-none d-sm-inline text-black mt-1">Signout</span>
                        </a>
                        <a href="/dashboard" class="d-flex flex-column align-items-center text-black nav-link1">
                            <i class=" fs-1 bi nav-item "><img class=""
                                    style="background-color: transparent; width: 30px; height: 29px;"
                                    src="/images/homeicon.png"></i>
                            <span class="ms-1 d-none d-sm-inline text-black ">Home</span>
                        </a>
                    </div>


                </div>

            </div>
            <div class="col-md-9 col-xl-10 offset-md-3 offset-xl-2 px-0">
                <!-- Content area... -->

                <div id="overlay" class="overlay"></div> <!-- Add overlay element -->

                <div id="customAlert" class="custom-alert">
                    <div id="toast-container" class="toast-container">
                        <div id="toast" class="toast"></div>
                    </div>
                    <div class="left-container">
                        <style>
                        </style>
                        <script src="https://unpkg.com/@dotlottie/player-component@latest/dist/dotlottie-player.mjs"
                            type="module"></script>
                        <dotlottie-player class="dotlottie-container"
                            src="https://lottie.host/9edc4e5b-7742-4c6a-a71f-a28f5b8945e7/2BPrQ2yDeu.json"
                            background="transparent" speed="1" style="width: 100%; height: 100%;" loop
                            autoplay></dotlottie-player>
                    </div>
                    <div class="right-container">
                        <h2>Age Calculator</h2>

                        <input type="date" id="birthdate" class="date-input">
                        <button type="button" id="calculateButton" class="calculate-button">Calculate Age</button>
                        <div id="output"></div> <!-- Placeholder for the output -->

                        <div class="button-container-age">
                            <button class="clear_btn age-btn" id="clear_btn" onclick="clearPrompt()">
                                <img src="/images/reset.png" alt="Clear Icon" width="25px" height="25px"
                                    style="margin-right: 5px;">
                                Clear
                            </button>
                            <button class="close_btn age-btn" id="close_btn">
                                <img src="/images/close.png" alt="Close Icon" width="25px" height="25px"
                                    style="margin-right: 5px;">
                                Close
                            </button>
                        </div>

                    </div>
                </div>


                <div class="main">

                    <h2>Registered Teacher Details</h2>

                    <div class="top-right-buttons">
                        <button id="refreshButton" onclick="refreshData()">
                            <img src="/images/refresh.png" alt="Refresh Icon" style="width: 25px; height: 25px;">
                            Refresh
                        </button>

                        <button id="export_registered_teacher" onclick="exportToExcel()">
                            <img src="/images/export.png" alt="Export Icon" style="width: 25px; height: 25px;"> Export
                        </button>
                    </div>

                    <div class="search_item">
                        <div style="position: relative; display: inline-block;">
                            <input type="text" id="searchField" placeholder="Enter Teacher Name..."
                                oninput="debouncedSearchDetails()">
                            <!-- <button id="searchButton" class="search-button" onclick="searchDetails()">
                                <img src="../images/search.gif" alt="Search Icon" style="height: 100%;">
                            </button> -->
                        </div>
                    </div>


                    <div id="output">
                        <table id="teacherTable">
                            <thead>
                                <tr>
                                    <th>Teacher Name</th>
                                    <th>Mobile No</th>
                                    <th>Address</th>
                                    <th>Date of Birth</th>
                                    <th>Qualification</th>
                                    <th>Experience</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody id="teacherData"></tbody>
                        </table>
                    </div>

                    <div id="loadingOverlay" class="loading-overlay">
                        <div class="pyramid-loader">
                            <div class="wrapper">
                                <span class="side side1"></span>
                                <span class="side side2"></span>
                                <span class="side side3"></span>
                                <span class="side side4"></span>
                                <span class="shadow"></span>
                            </div>
                        </div>

                    </div>


                </div>


                <!-- <div id="output" class="teacher-details"></div> -->

                <script>

                    function showLoadingAnimation() {
                        document.getElementById('loadingOverlay').style.display = 'flex';
                    }

                    function hideLoadingAnimation() {
                        document.getElementById('loadingOverlay').style.display = 'none';
                    }

                    // Function to add fade-up animation to table rows
                    function addFadeUpAnimation() {
                        const rows = document.querySelectorAll('#teacherData tr');
                        rows.forEach((row, index) => {
                            row.classList.add('fade-up');
                        });
                    }

                    async function refreshData() {
                        showLoadingAnimation();
                        const teacherTableBody = document.getElementById('teacherData');
                        teacherTableBody.innerHTML = ''; // Clear previous data
                        document.getElementById('searchField').value = '';
                        try {
                            const response = await fetch('/teachers');
                            const data = await response.json();
                            if (data.length === 0) {
                                hideLoadingAnimation();
                                const noResultsRow = document.createElement('tr');
                                noResultsRow.innerHTML = '<td colspan="10">No results found</td>';
                                // Assuming you have a table element to append this row to, e.g., teacherTable
                                teacherTableBody.appendChild(noResultsRow);
                            } else {
                                displayTeachers(data);
                            }
                        } catch (error) {
                            console.error('Error:', error);
                            // showToast('Error fetching teachers. Please try again.', true);
                        }
                    }

                    function displayTeachers(data) {
                        const teacherTableBody = document.getElementById('teacherData');
                        teacherTableBody.innerHTML = ''; // Clear previous data

                        try {
                            data.forEach(teacher => {
                                const row = document.createElement('tr');
                                row.innerHTML = `
            <td>${teacher.teacher_name}</td>
            <td>${teacher.mobile_no}</td>
            <td>${teacher.res_address}</td>
            <td>${teacher.dob}</td>
            <td>${teacher.qualification}</td>
            <td>${teacher.experience}</td>
            <td>
    <button style="background-color: transparent; 
                    border: none;
                    color: white;
                    padding: 0; /* Remove padding */
                    margin: 0 25px 0 0; /* Add margin to the right */
                    text-align: center;
                    text-decoration: none;
                    display: inline-block;
                    font-size: 14px; /* Reduced font size */
                    cursor: pointer;
                    max-height: 100%;
                    border-radius: 20px; /* Rounded corners */
                    transition: transform 0.2s; /* Add smooth transition */
                    "
            onclick="moveToAdmitted('${teacher.teacher_name}', '${teacher.mobile_no}', '${teacher.res_address}', '${teacher.dob}', '${teacher.qualification}', '${teacher.experience}')"
            onmouseover="this.style.transform='scale(1.3)'"
            onmouseout="this.style.transform='scale(1)'">
        <img src="/images/add_student.png" alt="Green Image" style="width: 20px; height: 20px; border-radius: 20px; margin: 0;"> <!-- Set width and height to 100% -->
    </button>
    <button style="background-color: transparent;
                    border: none;
                    color: white;
                    padding: 0; /* Remove padding */
                    margin: 0; /* Remove margin */
                    text-align: center;
                    text-decoration: none;
                    display: inline-block;
                    font-size: 14px; /* Reduced font size */
                    cursor: pointer;
                    max-height: 100%;
                    border-radius: 20px; /* Rounded corners */
                    transition: transform 0.2s; /* Add smooth transition */
                    "
            onclick="removeTeacher('${teacher.teacher_name}', '${teacher.mobile_no}')"
            onmouseover="this.style.transform='scale(1.3)'"
            onmouseout="this.style.transform='scale(1)'">
        <img src="/images/delete_student.png" alt="Red Image" style="width: 20px; height: 20px; border-radius: 20px; margin: 0;"> <!-- Set width and height to 100% -->
    </button>
</td>
        `;
                                teacherTableBody.appendChild(row);
                            });
                            addFadeUpAnimation();
                            hideLoadingAnimation();
                        } catch (error) {
                            console.error('Error displaying students:', error);
                            showToast('Error displaying students. Please try again.', true);
                            hideLoadingAnimation();
                        }
                    }
                    let debounceTimeout;

                    function debounce(func, delay) {
                        return function (...args) {
                            clearTimeout(debounceTimeout);
                            debounceTimeout = setTimeout(() => func.apply(this, args), delay);
                        };
                    }




                    async function searchDetails() {
                        // showLoadingAnimation();
                        console.log("executed")

                        const searchTerm = document.getElementById('searchField').value.trim();

                        // // Check if the search term is empty
                        // if (searchTerm === '') {
                        //     // alert('Please enter a search term.');
                        //     // showToast('Please enter a search term.', true); 
                        //     refreshData();
                        //     // hideLoadingAnimation();
                        //     return;
                        // }

                        // // If search term is empty, refresh data to show all teachers
                        // if (!searchTerm) {
                        //     refreshData();
                        //     return;
                        // }

                        // Fetch data from the server based on the search term
                        await fetch(`/teachers/search?search=${encodeURIComponent(searchTerm)}`)
                            .then(response => response.json())
                            .then(data => {
                                const teacherTable = document.getElementById('teacherData');
                                teacherTable.innerHTML = ''; // Clear previous data

                                if (data.length === 0) {
                                    console.log("No data")
                                    teacherTable.innerHTML = '';
                                    // If no results found, display a message
                                    const noResultsRow = document.createElement('tr');
                                    noResultsRow.innerHTML = '<td colspan="7">No results found</td>';
                                    teacherTable.appendChild(noResultsRow);
                                } else {
                                    console.log("yes data")
                                    // Append teacher data to the table
                                    data.forEach(teacher => {
                                        const row = document.createElement('tr');
                                        row.innerHTML = `
                        <td>${teacher.teacher_name}</td>
                        <td>${teacher.mobile_no}</td>
                        <td>${teacher.res_address}</td>
                        <td>${teacher.dob}</td>
                        <td>${teacher.qualification}</td>
                        <td>${teacher.experience}</td>
                        <td>
    <button style="background-color: transparent; 
                    border: none;
                    color: white;
                    padding: 0; /* Remove padding */
                    margin: 0 25px 0 0; /* Add margin to the right */
                    text-align: center;
                    text-decoration: none;
                    display: inline-block;
                    font-size: 14px; /* Reduced font size */
                    cursor: pointer;
                    max-height: 100%;
                    border-radius: 20px; /* Rounded corners */
                    transition: transform 0.2s; /* Add smooth transition */
                    "
            onclick="moveToAdmitted('${teacher.teacher_name}', '${teacher.mobile_no}', '${teacher.res_address}', '${teacher.dob}', '${teacher.qualification}', '${teacher.experience}')"
            onmouseover="this.style.transform='scale(1.3)'"
            onmouseout="this.style.transform='scale(1)'">
        <img src="/images/add_student.png" alt="Green Image" style="width: 20px; height: 20px; border-radius: 20px; margin: 0;"> <!-- Set width and height to 100% -->
    </button>
    <button style="background-color: transparent;
                    border: none;
                    color: white;
                    padding: 0; /* Remove padding */
                    margin: 0; /* Remove margin */
                    text-align: center;
                    text-decoration: none;
                    display: inline-block;
                    font-size: 14px; /* Reduced font size */
                    cursor: pointer;
                    max-height: 100%;
                    border-radius: 20px; /* Rounded corners */
                    transition: transform 0.2s; /* Add smooth transition */
                    "
            onclick="removeTeacher('${teacher.teacher_name}', '${teacher.mobile_no}')"
            onmouseover="this.style.transform='scale(1.3)'"
            onmouseout="this.style.transform='scale(1)'">
        <img src="/images/delete_student.png" alt="Red Image" style="width: 20px; height: 20px; border-radius: 20px; margin: 0;"> <!-- Set width and height to 100% -->
    </button>
</td>
                    `;
                                        teacherTable.appendChild(row);
                                    });
                                }
                                addFadeUpAnimation();
                                // hideLoadingAnimation();
                            })
                            .catch(error => console.error('Error:', error));
                    }
                    // Debounced version of searchDetails
                    const debouncedSearchDetails = debounce(searchDetails, 500);


                    async function moveToAdmitted(teacherName, mobileNo, address, dob, qualification, experience) {
                        const confirmation = confirm(`Are you sure you want to admit the teacher "${teacherName}"?`);
                        if (confirmation) {
                            showLoadingAnimation();
                            await fetch(`/move-to-admitted-teacher?name=${encodeURIComponent(teacherName)}&mobile=${encodeURIComponent(mobileNo)}&address=${encodeURIComponent(address)}&dob=${encodeURIComponent(dob)}&qualification=${encodeURIComponent(qualification)}&experience=${encodeURIComponent(experience)}`, {
                                method: 'POST'
                            })
                                .then(response => {
                                    if (!response.ok) {
                                        throw new Error('Failed to admit teacher.');
                                    }
                                    hideLoadingAnimation();
                                    showToast('Teacher admitted successfully.', false); // Show error toast
                                    // alert('Teacher admitted successfully.'); // Log success message
                                    refreshData();
                                })
                                .catch(error => {
                                    console.error('Error admitting teacher:', error);
                                    hideLoadingAnimation();
                                    // alert('An error occurred while admitting the teacher.');
                                    showToast('An error occurred while admitting the teacher.', true); // Show error toast
                                });
                        } else {
                            console.log('Admission canceled.'); // Log cancellation message
                        }
                    }

                    async function removeTeacher(teacherName, mobileNo) {
                        const confirmation = confirm(`Are you sure you want to remove the teacher "${teacherName}"?`);
                        if (confirmation) {
                            showLoadingAnimation();
                            await fetch(`/remove-teacher?name=${encodeURIComponent(teacherName)}&mobile=${encodeURIComponent(mobileNo)}`, {
                                method: 'DELETE'
                            })
                                .then(response => {
                                    if (!response.ok) {
                                        throw new Error('Failed to remove teacher.');
                                    }
                                    hideLoadingAnimation();
                                    showToast('Teacher deleted successfully.', false); // Show error toast
                                    // alert('Teacher removed successfully.'); // Log success message
                                    refreshData(); // Refresh data after removing the teacher
                                })
                                .catch(error => {
                                    console.error('Error removing teacher:', error);
                                    hideLoadingAnimation();
                                    showToast('An error occurred while removing the teacher.', true); // Show error toast
                                    // alert('An error occurred while removing the teacher.');
                                });
                        }
                    }

                    function exportToExcel() {
                        var htmlTable = document.getElementById('teacherTable');
                        var html = htmlTable.outerHTML;

                        // Generate a temporary download link
                        var downloadLink = document.createElement("a");
                        document.body.appendChild(downloadLink);

                        // CSV representation of the HTML table
                        var csv = [];
                        var rows = htmlTable.rows;
                        for (var i = 0; i < rows.length; i++) {
                            var row = [], cols = rows[i].cells;
                            for (var j = 0; j < cols.length - 1; j++)
                                row.push(cols[j].innerText);
                            csv.push(row.join(","));
                        }

                        // Convert to CSV string
                        var csvContent = csv.join("\n");

                        // Set CSV as href and download attributes
                        downloadLink.href = 'data:text/csv;charset=utf-8,' + encodeURI(csvContent);
                        downloadLink.download = 'Registered_Teachers.csv';

                        // Trigger the download
                        downloadLink.click();
                    }

                    function showToast(message, isError) {
                        const toastContainer = document.getElementById("toast-container");

                        // Create a new toast element
                        const toast = document.createElement("div");
                        toast.classList.add("toast");
                        if (isError) {
                            toast.classList.add("error");
                        }
                        toast.textContent = message;

                        // Append the toast to the container
                        toastContainer.appendChild(toast);

                        // Show the toast
                        toast.style.display = 'block';

                        // Remove the toast after 4 seconds
                        setTimeout(function () {
                            toast.style.animation = 'slideOutRight 0.5s forwards';
                            toast.addEventListener('animationend', function () {
                                toast.remove();
                            });
                        }, 4000);
                    }


                    refreshData();
                </script>

<script src="/js/Universal_Components_JS/handle_session.js"></script>
<script src="/js/Pre_Admission_Console_js/age_calculator.js"></script>

</body>